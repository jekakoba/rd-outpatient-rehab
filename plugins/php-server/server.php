<?php

/**
 * @fileoverview Роутер для PHP-сервера, який обробляє запити до PHP-файлів у вказаній директорії.
 * Налаштовує відображення помилок, визначає запитаний URI, перевіряє наявність файлу
 * і повертає його вміст або помилку 404, якщо файл не знайдено.
 */

// Налаштування відображення помилок для зручності налагодження.
// Увімкнення відображення помилок виконання та помилок запуску.
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// Запитаний URI, очищений від параметрів і декодований.
$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
$uri = urldecode($uri);

// Базова директорія, де зберігаються PHP-файли для обробки запитів.
$publicDir = '../../src/php/';

// Якщо запитаний кореневий шлях ('/'), перенаправляємо на index.php.
if ($uri === '/') {
   $uri = '/index.php';
}

// Повний шлях до запитаного файлу, сформований на основі базової директорії та URI.
$requested = $publicDir . $uri;

/**
 * Перевірка існування запитаного файлу та його розширення.
 * Якщо файл існує і має розширення '.php', він підключається для обробки.
 * В іншому випадку повертається помилка 404.
 * 
 * @return bool Завжди повертає true для сумісності з сервером (наприклад, node-php-server).
 */
if (file_exists($requested) && pathinfo($requested, PATHINFO_EXTENSION) === 'php') {
   require_once $requested;
   return true;
}

/**
 * Відправляє HTTP-код 404 і виводить повідомлення про помилку, якщо запитаний файл не знайдено.
 * 
 * @return bool Завжди повертає true для сумісності з сервером (наприклад, node-php-server).
 */
http_response_code(404);
echo "404 Not Found";
return true;
